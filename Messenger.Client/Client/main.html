<!DOCTYPE html>
<html>
    <head>
        <title>Messenger App. Version 0.2.0</title>
        <script type="text/javascript" src="js/rest.js"></script>
        <script type="text/javascript" src="js/mainActions.js"></script>
        <script type="text/javascript" src="js/jquery-1.7.1.min.js"></script>
        <!--<script type="text/javascript" src="../node_modules/easy-autocomplete/dist/jquery.easy-autocomplete.min.js"></script>-->
        <link rel="stylesheet" href="./css/mainStyles.css">
    </head>
    <body onload="OnLoad()" class="body">
        <!-- Панель с кнопками-->
        <div class="cmdPanel">
            <div class="divButtonChats" id="chats">
                <img class="icon" src="./img/chats.png" height="25px" width="25px" vspace="5px" hspace="5px" title="Чаты">
            </div>
            <div class="divButtonCreate" id="create">
                <img class="icon" src="./img/createChat.png" height="25px" width="25px" vspace="5px" hspace="5px" title="Создать чат">
            </div>
            <div class="divButtonFind">
                <img class="icon" src="./img/find.png" height="25px" width="25px" vspace="5px" hspace="5px" title="Поиск">
            </div>
            <div class="divButtonSettings">
                <img class="icon" src="./img/settings.png" height="25px" width="25px" vspace="5px" hspace="5px" title="Настройки"/>
            </div>
            <div class="divButtonPeople">
                <img class="icon" src="./img/people2.png" height="25px" width="25px" vspace="5px" hspace="6px" title="Пользователи">
            </div>
            <div class="divButtonLogout" id="divButtonLogout">
                <img class="icon" src="./img/logout.png" height="25px" width="25px" vspace="5px" hspace="6px" title="Выход">
            </div>
        </div>
        <!-- Сделать настройки -->
        <!-- Боковые панели -->
        <div class="slidePanelWrap">
            <div class="chatsPanel" align="center">
                <div style="color: rgb(64, 64, 179);">
                    <label class="label"><br/><h1>Чаты:</h1></label>
                </div>
                <div id="chatList">
                    <label class="label" style="color:#ffffff">Здесь пока нет ни одного чата:(</label>
                </div>
            </div>
            <div class="createPanel" align="center">
                <div style="color: rgb(64, 64, 179);" >
                    <label class="label"><br/><h1>Создать чат</h1></label>
                </div>
                <div id="divChatName" class="inputBox">
                    <label class="label" style="color:#ffffff">Название чата:<br/><br/></label>
                    <div>
                        <input class="createChatArea" id="txtChatName" class="textbox"  type="textbox" value="Testing chat"/>
                    </div>
                </div>
                <div id="divButtons">
                    <br/>
                    <input id="createButton" class="createChatArea" value="Создать чат" type="button" onclick="CreateChat()"/>
                </div>
            </div>
            <div class="findPanel" align="center">
                <div style="color: rgb(64, 64, 179);" >
                    <label class="label"><br/><h1>Поиск:</h1></label>
                </div>
                <input class="createChatArea" type="textbox" id="findString"><br/><br/>
                <button class="createChatArea" onclick="Find()">Найти</button>
                <div id="searchResults">
                </div>
            </div>
            <div class="settingsPanel" align="center">
                <div style="color: rgb(64, 64, 179);">
                    <label class="label"><br/><h1>Настройки:</h1></label>
                </div>
            </div>
            <div class="logoutPanel" align="center">
                <div style="color: rgb(64, 64, 179);">
                    <label class="label"><br/><h1>Выход из сети</h1></label>
                    <label class="label">Вы уверены?<br/><br/></label>
                    <button class="createChatArea" style="display:inline" onclick="window.location='index.html'">Да</button>
                    <button class="createChatArea" style="display:inline" onclick="document.getElementById('divButtonLogout').click()">Вернуться</button>
                </div>
            </div>
            <div class="peoplePanel" align="center">
                <div style="color: rgb(64, 64, 179);">
                    <label class="label"><br/><h1>Пользователи</h1></label>
                </div>
                <div id="chatProfiles">
                    <label style="color:#ffffff">Чат не выбран</label>
                </div>
            </div>
            <input type="hidden" id="chatsHidden" value="false"/>
            <input type="hidden" id="findHidden" value="false"/>
            <input type="hidden" id="createHidden" value="false"/>
            <input type="hidden" id="logoutHidden" value="false"/>
            <input type="hidden" id="peopleHidden" value="false"/>
            <input type="hidden" id="settingsHidden" value="false"/>
        </div>
        <!-- Панель всплывающих сообщений -->
        <div class="popUp" id="popUp" style="z-index:99;visibility:hidden; height:40px; width:50vw; position:absolute; left:25vw; top:20px">
            <label id="popUpMessage"></label>
        </div>
        <!-- Сделать отображение файлов -->
        <!-- Панель чата -->
        <div class="dialogPanel">
			<div class="dialogMeta" id="dialogMeta">
                <img src="./img/chatWithoutImage.png" height="25px" width="25px" vspace="5px" hspace="5px" style="display:inline-block"/>
				<label id="dialogName" class="dialogName" style="display:inline-block; margin-bottom:5px"></label>
			</div>

            <div id="dialog" class="dialog">
            </div>
            <div class="messageBox" style="background-color:#202020; /*visibility:hidden;*/ width:100%; height:39px; position:absolute; bottom:3px; left: 0px; min-width:765px" id="messageBox">
                <div id="preview" style="position:absolute;left:35px;height:110px;width:100px;resize:none;top:5px; bottom:5px;display:inline-block">
                </div>
                <div class="divButton" id="attachButton" style="background-color:#202020;width:35px; display:inline-block;position:absolute;bottom:5px;">
                    <label for="file-input">
                        <img class="icon" src="./img/attach.png" height="25px" width="25px" vspace="5px" hspace="4px" title="Прикрепить файл"/>
                    </label>
                    <input id="file-input" type="file" style="width:25px; height:25px"/>
                </div>
                <textarea class="messageArea" style="position:absolute;left:35px;resize:none;bottom:0;overflow:hidden; overflow-y: scroll; min-width:600px;height:39px; width:calc(100% - 95px)" id="messageArea"></textarea>
                <div class="divButton" id="sendButton" style="background-color:#202020;width:35px;display:inline-block; position:absolute; left:calc(100% - 40px);bottom:3px;" onclick="SendMessage();">
                    <img class="icon" src="./img/send.png" height="25px" width="25px" vspace="5px" hspace="5px" title="Отправить"/>
                </div>
                <script>
                    (function()
                    {
                        var inpElem = document.getElementById('file-input'),
                            divElem = document.getElementById('preview');
                        
                        inpElem.addEventListener("change", function(e) {
                            preview(this.files[0]);
                        });
                        function preview(file) 
                        {
                            divElem.innerHTML = "";
                            inpElem.innerHTML = inpElem.innerHTML;
                            if ( file.type.match(/image.*/) ) 
                            {
                                document.getElementById('messageBox').setAttribute("style",
                                "visibility:visible;background-color:#202020; vertical-align:center; width:100%; height:159px; position:absolute; bottom:5px; left: 0px; min-width:765px");    

                                var reader = new FileReader(), img;
                                reader.addEventListener("load",
                                function(event)
                                {
                                    img = document.createElement('img');
                                    img.setAttribute("style", "top:5px;height:100px;width:100%;display:inline-block");
                                    img.setAttribute("id", "previewImage");
                                    img.src = event.target.result;
                                    divElem.appendChild(img);
                                });
                                reader.readAsDataURL(file);
                            }
                            else
                            {
                                document.getElementById('messageBox').setAttribute("style",
                                "visibility:visible;background-color:#202020; vertical-align:center; width:100%; height:159px; position:absolute; bottom:5px; left: 0px; min-width:765px");    

                                var img;
                                img = document.createElement('img');
                                img.setAttribute("style", "margin-top:5px;height:100px;width:100%;display:inline-block");
                                img.setAttribute("id", "previewImage");
                                img.src = event.target.result;
                                divElem.appendChild(img);
                                alert(file.type);
                                switch(file.type)
                                {
                                    case 'text/plain':
                                    {
                                        img.src = "img/fileIcons/txtFile.png";
                                        break;
                                    }
                                    case 'application/pdf':
                                    {
                                        img.src = "img/fileIcons/pdfFile.png";
                                        break;
                                    }
                                    case 'application/msword':
                                    {
                                        img.src = "img/fileIcons/docFile.png";
                                        break;
                                    }
                                    case 'audio/mpeg3':
                                    case 'audio/x-mpeg3':
                                    case 'video/mpeg':
                                    case 'video/x-mpeg':
                                    case 'audio/mp3':
                                    {
                                        img.src = "img/fileIcons/mp3File.png";
                                        break;
                                    }
                                    case 'application/zip':
                                    {
                                        img.src = "img/fileIcons/zipFile.png";
                                        break;
                                    }
                                    case 'application/x-compress':
                                    {
                                        img.src = "img/fileIcons/7zipFile.png";
                                        break;
                                    }
                                    default:
                                    {
                                        img.src = "img/fileIcons/file.png";
                                        break;
                                    }
                                }
                            } 
                        }
                    })();
                </script>
            </div>
        </div>
        <input type="hidden" id="profileId" value=""/>
        <input type="hidden" id="chatId" value=""/>
        <input type="hidden" id="cache" value="Привет$"/>
        <input type="hidden" id="count" value="0"/>
    </body>
</html>